<html>

<head>
  <title>Oregon</title>
  <link rel="stylesheet" href="/stylesheets/style.css">
  <link href="https://fonts.googleapis.com/css?family=Space+Mono" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
  <script src="/javascripts/term.js"></script>
</head>

<body class="blue-grey darken-4">
  <div id="term-page">
    <nav class="blue-grey darken-3">
      <div class="nav-wrapper">
        <a href="#" class="brand-logo center">Oregon</a>
        <ul id="nav-mobile" class="left">
          <li><a href="#">About</a></li>
        </ul>
        <ul class="right">
          <li><a href="#"><i class="material-icons">menu</i></a></li>
        </ul>
      </div>
    </nav>
    <div class="info blue-grey darken-2"></div>
    <div class="page-contain white-text">
      <div class="roundscreen">
        <!-- <div class="window-header blue darken-2">
          Oregon
        </div> -->
        <div class="text-contain">
          <p v-for="line in main.lines">
            <template v-if="line.type === 'input'">
              <span class="grey-text text-darken-2">> </span>
              <span class="input">{{ line.text }}<span v-if="line.active" class="cursor">_</span></span>
            </template>
            <template v-else-if="line.type === 'output'">
              <span class="grey-text text-darken-2">~$ </span>
              <span class="written">{{ line.text }}</span>
            </template>
            <span v-else><br></span>
          </p>
        </div>
      </div>
    </div>
  </div>
</body>

<script type="text/javascript">
  const LINES = 30
  var main = new Term()
  var data = {
    main: main,
    game: {

    },
    player: {

    }
  }

  var methods = {
    promptHunt: function () {
      hunt = game.actions.hunt
      prompt = Math.floor(Math.random() * hunt.prompts.length)
      var response = out.prompt(hunt.prompts[prompt])
    }
  }

  var vm = new Vue({
    el: '#term-page',
    data: data,
    methods: methods
  })

  async function loadGame(sn) {
    game = (await axios.get('/' + sn)).body.game
  }

  async function newGame() {
    game = (await axios.get('/new' + sn)).body.game
  }


  async function startGame(term) {
    term.writeLines([
      'Greetings traveller!',
      'Would you like to',
      ' (1) Start a new journey',
      ' (2) Continue your travels'
    ])
    var choice = await data.main.readLine()
    if (choice === '1') {
      term.writeLine('One moment while your game is created...')
      term.writeLine('Your Save Number is ' + await newGame())
    } else if (choice === '2') {
      term.writeLine('Excellent, please enter your Save Number below:')
      var sn = await term.readLine()
      var game = null
      while (!game) {
        try {
          await loadGame(sn)
        } catch {
          term.writeLine('Invalid save number: "' + sn + '"')
          term.writeLine('Please enter your Save Number below:')
          sn = await term.readLine()
        }
      }
      while (true) {
        await playTurn()
      }
    } else {
      term.writeLine('Invalid response. Options are "1" or "2"')
      await startGame(term)
    }
  }

  startGame(main).then(function () {

  }).catch(function () {
    alert('Something went wrong. Please write down your save number if you have one, then reload the page.')
  })
</script>

</html>